### enum의 싱글턴 성질 이용하기

흔히 enum은 자바에서 완벽하게 싱글턴을 구현할 수 있는 방법으로 알려져 있다. 현재 프로모션 미션에서는 사전에 주어진 메뉴를 미리 생성해놔야 한다. 이때 메뉴를 복사하는 과정에서 같은 메뉴가 여러 개 생성될 수 있다. 이를 방지하기 위해 enum의 성질을 이용할 수 있다.

enum의 각 인스턴스는 싱글턴임이 보장된다. 따라서 enum 인스턴스의 멤버로 메뉴를 설정해두면, 해당 메뉴 역시 싱글턴의 멤버이므로 단 하나만 존재함이 보장된다. 사실 메뉴 클래스는 record 클래스, 즉 VO이므로 참조 주소가 다르더라도 동등함이 보장된다. 따라서  동등성을 위해서 싱글톤으로 참조 주소가 같음을 보장해줄 필요는 없다. 하지만 같은 객체를 여러 번 생성하는 것이 메모리 관리 관점에서 좋지는 않으므로, enum으로 만드는 것이 좋다.


### 인터페이스

인터페이스의 메서드를 선언할 때 몇몇 자료에서는 abstract를 지정하는 경우가 있다.
지정을 해도 되고 안해도 되는데, 재밌게도 자바 공식 명세에서는 abstract를 지정하지 않는 것을 권장한다. 이유는 다음과 같다.

> An interface method lacking a private, default, or static modifier is implicitly abstract. Its body is represented by a semicolon, not a block. It is permitted, but discouraged as a matter of style, to redundantly specify the abstract modifier for such a method declaration.

즉 인터페이스 메서드는 private, default, static이 불가능하다. 따라서 abstract를 지정하지 않아도 암시적으로 abstract이 된다. 하지만 스타일 상 문제 및 Java의 이전 버전과의 호환성을 위해 abstract를 지정하는 것을 권장하지 않는다고 한다. 흥미롭다...


### 날짜 정책

DatePolicy 라는 것을 만들었다. 저번에 정리한 내용을 보면 할인 과정은 이렇게 된다.

- 먼저 이벤트를 적용할 수 있는지 검증한다.
    - 이벤트 기간에 포함되는지 검증한다.
    - 지정 요일에 해당하는지 검증한다.
    - 지정일에 해당하는지 검증한다.
    - 총 주문 금액이 10000원 이상인지 검증한다.
- 할인 이벤트를 적용한다.
    - 메뉴 당 적용하는 경우
        - 적용 대상 메뉴의 개수를 확인한다.
        - 총 할인 금액은 적용 대상 메뉴의 개수의 총합 * 메뉴 할인 금액이다.
        - 총 할인 금액이 양수이면 할인 금액을 적용한다.
    - 총 주문 금액에 적용하는 경우
        - 총 주문 금액이 기준 금액 이상인지 검증한다.
        - 할인 금액만큼 할인을 적용한다.
- 증정 이벤트를 적용한다.
    - 할인 전 총 주문 금액이 기준 금액 이상인지 검증한다.
    - 증정 메뉴를 지급한다.

할인 정책의 경우 적용 조건과 적용 방법이 정말정말 다양할 수 있다. 그래서 이 이벤트 관련 구현에 굉장히 고민을 많이 했다. 할인 후 금액, 즉 에상 결제 금액 증정 이벤트를 할 수 있다면? 예상 결제 금액에서 한번 더 할인 이벤트를 적용한다면? 모든 경우를 고려해서 추상화할 수는 없다. YAGNI를 지켜야 하지 않겠는가?

일단 증정 이벤트에서 '할인 전 주문금액'과 '할인 후 주문금액'을 기준으로 증정이벤트의 적용가능여부에 대하여 정책 인터페이스를 추가할 수 있다. 하지만 그건 좀 과하니까 증정 이벤트는 딱 단일 구현체로 해놓고 추상화로 빼는 건 나중에 고민하자. 대신 할인 이벤트는 추상화를 칠 건데, 대신 '예상결제금액'에서 할인하는 경우까지는 생각하지 말자. 주어진 요구사항에 대하여 수평적으로 정책이 늘어나는 경우만 고민해보자.


요일 정책 구현할 때 주문을 인자로 받는데, 주문을 까서 검증하지 말고 최대한 주문에게 묻는 식으로 검증한다. 뭐라 말하기가 애매한데 일단 구현부터 해보자.

OrderDiscountPolicy에서 할인 금액 계산 메서드를 Supplier로 구현하자. 동적 로직이 필요함.

DatePolicyFactory도 추가해서 조금 더 의미있는 날짜 정책을 붙여보자. 요구사항에는 평일, 주말, 이벤트 달력 별표 처리된 날... 이런 것들이 있다. 

날짜 정책 -> 원하면 MixedDatePolicy 같은 것도 가능. 구현만 야무지게 잘 하면 된다. 딱 적정수준 추상화 하면서 확장성도 잘 고려했다!