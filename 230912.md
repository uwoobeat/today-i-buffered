230912

### 다이나믹 팩토리 패턴
다이나믹 팩토리 패턴이라는 것이 있다.

https://inpa.tistory.com/entry/GOF-%F0%9F%92%A0-Dynamic-Factory-%EB%B3%80%ED%98%95-%ED%8C%A8%ED%84%B4-%EC%95%8C%EC%95%84%EB%B3%B4%EA%B8%B0

리플렉션을 활용하여 런타임에 서브타입 클래스 정보를 얻고, 클래스 이름을 키 정보로, 클래스 객체를 값으로 가지는 맵을 런타임에 초기화한 뒤 가져가 쓰는 방법이다.

이전에 썼던 글에서 전략 패턴이라고 생각했는데 생각해보니 다이나믹 팩토리 패턴이 맞는 것 같다... 수정해야 할듯


### 통합 테스트와 단위 테스트

블랙박스 테스트와 화이트박스 테스트가 있다. 블랙박스 테스트는 내부 구현을 모르는 상태에서 input과 output을 검증하는 것이고, 화이트박스 테스트는 내부 구현을 검증하는 방식이다.

그렇다면 왜 향로님의 글에서는 '내부 구현을 검증하면 안된다'고 했을까?

이는 depth level이 끝없이 깊어질 수 있기 때문이다. 그리고, 내부 구현을 검증하다보면 결국 내부 구현을 구성하는 다른 클래스를 mocking하고 stubbing하게 된다. 그렇게 되면 의존하고 있는 다른 클래스에 대하여 세부 구현을 상위 모듈에서 기술하게 되고 이는 즉 DIP 위반이다. 

그렇다면 결론이 뭔데?

내부 구현을 검증하면 안된다 == 내부 구현의 검증 책임은 해당 구현 클래스에게 있다 라고 생각하면 된다.


그렇게 되면 예전에 언급했던 내용들이 모두 정리된다.

"리팩토링은 deepest branch에서 shortest branch로, 테스트는 shortest branch에서 deepest branch로" 라는 말이 있다.

말이 좀 어렵긴 한테 "테스트는 밖에서부터 돌려깎고 리팩토링은 안쪽에서부터 뜯어고쳐라" 라는 뜻이다.

즉 밖에서부터 돌려깎으란 뜻은 레거시에 테스트를 붙일 때는 통합 테스트부터 시작해서 단위 테스트로 deep-dive 하는 방식을 채택하라는 것이다.


이미 존재하는 코드베이스에 통합 테스트 -> 단위 테스트 순으로 테스트를 작성하게 되면 얻게 되는 이점이 바로 이것이다. 통합 테스트를 작성하게 되면 mocking과 stubbing이 최소화되게 된다. 하지만, 이 경우 내부 구현에서 의존하고 있는 다른 클래스가 black box 영역이 되므로, 해당 영역을 다시 white box로 만들기 위해 각 모듈에 대한 테스팅을 수행한다. 이렇게 하면 각 테스트가 하위 모듈을 검증하는 경우를 최소화시키면서, 전체 테스트를 white box로 만들 수 있다.

말이 좀 횡설수설한데 전체 black box로 이루어진 큰 테스트 상자를 바깥쪽부터 white box로 만들어나간다는 의미다.

나중에 다시 정리해서 글로 써봐야겠다...